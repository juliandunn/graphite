# Generated by Chef for <%= node[:hostname] %>
#
# VirtualHost example:
# Almost any Apache directive may go into a VirtualHost container.
# The first VirtualHost section is used for requests without a known
# server name.
#

<VirtualHost *:<%= @port %>>
        ServerName <%= @servername %>
        <% unless @serveralias.nil? -%>
          <% if @serveralias.respond_to?(:each) -%>
        ServerAlias <% @serveralias.each do |sa| -%><%= sa %> <% end -%>
          <% else -%>
        ServerAlias <%= @serveralias %>
          <% end -%>
         <% end -%>
        DocumentRoot <%= @documentroot %>
        ErrorLog logs/<%= @servername %>-error_log
        CustomLog logs/<%= @servername %>-access_log common

        WSGIDaemonProcess graphite processes=5 threads=5 display-name='%{GROUP}' inactivity-timeout=120
        WSGIProcessGroup graphite
        WSGIApplicationGroup %{GLOBAL}
        WSGIImportScript /opt/graphite/conf/graphite.wsgi process-group=graphite application-group=%{GLOBAL}

        WSGIScriptAlias / /opt/graphite/conf/graphite.wsgi

        <Location "/content">
                SetHandler None
        </Location>

        # The graphite.wsgi file has to be accessible by apache. It won't
        # be visible to clients because of the DocumentRoot though.
        <Directory /opt/graphite/conf>
                Order deny,allow
                Allow from all
        </Directory>

        <Directory /opt/graphite/storage>
                Order deny,allow
                Allow from all
        </Directory>

</VirtualHost>